---
description: 
globs: 
alwaysApply: true
---
# Instru√ß√µes Sistema de Gerenciamento de Filmes
## Configura√ß√£o para Desenvolvedor S√™nior

---

## üéØ **CONTEXTO DO PROJETO**

Voc√™ est√° trabalhando como **Desenvolvedor Full-Stack S√™nior** em um sistema de gerenciamento de filmes com:
- **Backend**: Laravel PHP com API RESTful
- **Frontend**: React com Redux
- **Banco**: PostgreSQL
- **Auth**: JWT
- **Deploy**: Docker

**Objetivo**: Criar c√≥digo de produ√ß√£o seguindo padr√µes enterprise e melhores pr√°ticas.

---

## üèóÔ∏è **PADR√ïES ARQUITETURAIS OBRIGAT√ìRIOS**

### Backend (Laravel)
```
Backend (Laravel + DDD)
SEMPRE implemente estes padr√µes DDD:
- Domain Layer: Entities, Value Objects, Domain Services
- Application Layer: Use Cases/Application Services  
- Infrastructure Layer: Repositories, External Services
- Interface Layer: Controllers, Resources, Requests
- Repository Pattern para abstra√ß√£o de dados
- Service Layer para casos de uso da aplica√ß√£o
- Domain Services para l√≥gica de dom√≠nio complexa
- DTO Pattern para transfer√™ncia de dados
- Request Validation com Form Requests
- Resource/Transformer para API responses
- Exception Handling centralizado
- Interface Segregation Principle
- Aggregate Pattern para consist√™ncia de dados
```
### Frontend (React)
```
SEMPRE implemente estes padr√µes:
- Component composition over inheritance
- Custom hooks para l√≥gica reutiliz√°vel
- Separation of concerns (UI/Logic/Data)
- Error boundaries para componentes
- Memoization para performance
- TypeScript-like prop validation
```

---

## üìù **CONVEN√á√ïES DE C√ìDIGO**

### Nomenclatura
```javascript
// ‚úÖ CORRETO
const getUserMovies = async (userId) => {}
const MovieDetailsCard = ({ movie }) => {}
const useMovieFilters = () => {}

// ‚ùå INCORRETO
const getmovies = () => {}
const moviecard = () => {}
const hook1 = () => {}
```

### Estrutura de Arquivos
```
// ‚úÖ SEMPRE organize assim:
backend/
‚îú‚îÄ‚îÄ app/Domain/
‚îÇ   ‚îú‚îÄ‚îÄ Movie/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Entities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ValueObjects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Contracts/
‚îÇ   ‚îî‚îÄ‚îÄ User/
‚îú‚îÄ‚îÄ app/Application/
‚îÇ   ‚îú‚îÄ‚îÄ Movie/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UseCases/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DTOs/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Services/
‚îú‚îÄ‚îÄ app/Infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ Repositories/
‚îÇ   ‚îú‚îÄ‚îÄ ExternalServices/
‚îÇ   ‚îî‚îÄ‚îÄ Persistence/
‚îú‚îÄ‚îÄ app/Interface/
‚îÇ   ‚îú‚îÄ‚îÄ Http/Controllers/Api/
‚îÇ   ‚îú‚îÄ‚îÄ Http/Requests/
‚îÇ   ‚îú‚îÄ‚îÄ Http/Resources/
‚îÇ   ‚îî‚îÄ‚îÄ Console/Commands/

frontend/
‚îú‚îÄ‚îÄ src/components/ui/
‚îú‚îÄ‚îÄ src/pages/
‚îú‚îÄ‚îÄ src/hooks/
‚îú‚îÄ‚îÄ src/services/
‚îú‚îÄ‚îÄ src/store/
‚îî‚îÄ‚îÄ src/utils/
```

---

## üíª **TEMPLATES DE C√ìDIGO**


### 3. React Component com Hooks
```jsx
// SEMPRE use este template para componentes React
import React, { useState, useEffect, useCallback, memo } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import { fetchMovies, selectMovies, selectMoviesLoading } from '../store/movieSlice';
import { MovieCard } from '../components/ui/MovieCard';
import { LoadingSpinner } from '../components/ui/LoadingSpinner';
import { ErrorBoundary } from '../components/ui/ErrorBoundary';

const MovieList = memo(() => {
  const dispatch = useDispatch();
  const navigate = useNavigate();
  const movies = useSelector(selectMovies);
  const isLoading = useSelector(selectMoviesLoading);
  
  const [searchTerm, setSearchTerm] = useState('');

  useEffect(() => {
    dispatch(fetchMovies());
  }, [dispatch]);

  const handleMovieClick = useCallback((movieId) => {
    navigate(`/movies/${movieId}`);
  }, [navigate]);

  const handleSearch = useCallback((term) => {
    setSearchTerm(term);
    // Implementar debounce aqui
  }, []);

  if (isLoading) {
    return <LoadingSpinner />;
  }

  return (
    <ErrorBoundary>
      <div className="movie-list">
        <div className="movie-grid">
          {movies.map(movie => (
            <MovieCard
              key={movie.id}
              movie={movie}
              onClick={() => handleMovieClick(movie.id)}
            />
          ))}
        </div>
      </div>
    </ErrorBoundary>
  );
});

MovieList.displayName = 'MovieList';
export default MovieList;
```

### 4. Custom Hook
```jsx
// SEMPRE crie hooks customizados para l√≥gica complexa
import { useState, useEffect, useCallback } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { movieService } from '../services/movieService';

export const useMovieOperations = () => {
  const dispatch = useDispatch();
  const { movies, loading, error } = useSelector(state => state.movies);
  
  const [operationLoading, setOperationLoading] = useState(false);

  const createMovie = useCallback(async (movieData) => {
    setOperationLoading(true);
    try {
      const newMovie = await movieService.create(movieData);
      dispatch(addMovie(newMovie));
      return { success: true, data: newMovie };
    } catch (error) {
      return { success: false, error: error.message };
    } finally {
      setOperationLoading(false);
    }
  }, [dispatch]);

  const updateMovie = useCallback(async (id, movieData) => {
    setOperationLoading(true);
    try {
      const updatedMovie = await movieService.update(id, movieData);
      dispatch(updateMovieInStore(updatedMovie));
      return { success: true, data: updatedMovie };
    } catch (error) {
      return { success: false, error: error.message };
    } finally {
      setOperationLoading(false);
    }
  }, [dispatch]);

  return {
    movies,
    loading: loading || operationLoading,
    error,
    createMovie,
    updateMovie
  };
};
```

---

## üõ°Ô∏è **REGRAS DE SEGURAN√áA**

### Sempre Implementar:
```php
// ‚úÖ Valida√ß√£o de entrada
public function store(MovieStoreRequest $request) {
    // Request j√° validado automaticamente
}

// ‚úÖ Sanitiza√ß√£o de dados
$cleanData = $this->sanitizeInput($request->all());

// ‚úÖ Autoriza√ß√£o
$this->authorize('create', Movie::class);

// ‚úÖ Rate limiting
Route::middleware(['throttle:api'])->group(function () {
    // rotas aqui
});
```

```jsx
// ‚úÖ Sanitiza√ß√£o no frontend
const sanitizeInput = (input) => {
  return input.trim().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
};

// ‚úÖ Valida√ß√£o de props
MovieCard.propTypes = {
  movie: PropTypes.shape({
    id: PropTypes.number.isRequired,
    titulo: PropTypes.string.isRequired,
    ano_lancamento: PropTypes.number.isRequired
  }).isRequired
};
```

---

## üß™ **PADR√ïES DE TESTE**

### Laravel (PHPUnit)
```php
// SEMPRE crie testes seguindo este padr√£o
class MovieServiceTest extends TestCase
{
    use RefreshDatabase;

    private MovieService $movieService;
    private Movie $movie;

    protected function setUp(): void
    {
        parent::setUp();
        $this->movieService = app(MovieService::class);
        $this->movie = Movie::factory()->create();
    }

    /** @test */
    public function it_can_create_a_movie(): void
    {
        // Arrange
        $movieData = [
            'titulo' => 'Teste Movie',
            'ano_lancamento' => 2023,
            'genero' => 'Action',
            'sinopse' => 'Test synopsis'
        ];

        // Act
        $movie = $this->movieService->createMovie($movieData);

        // Assert
        $this->assertInstanceOf(Movie::class, $movie);
        $this->assertEquals('Teste Movie', $movie->titulo);
        $this->assertDatabaseHas('movies', ['titulo' => 'Teste Movie']);
    }
}
```

### React (Jest + React Testing Library)
```jsx
// SEMPRE teste componentes seguindo este padr√£o
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { Provider } from 'react-redux';
import { BrowserRouter } from 'react-router-dom';
import { configureStore } from '@reduxjs/toolkit';
import MovieList from '../MovieList';
import movieReducer from '../../store/movieSlice';

const renderWithProviders = (component, initialState = {}) => {
  const store = configureStore({
    reducer: { movies: movieReducer },
    preloadedState: initialState
  });

  return render(
    <Provider store={store}>
      <BrowserRouter>
        {component}
      </BrowserRouter>
    </Provider>
  );
};

describe('MovieList Component', () => {
  const mockMovies = [
    { id: 1, titulo: 'Test Movie 1', ano_lancamento: 2023 },
    { id: 2, titulo: 'Test Movie 2', ano_lancamento: 2024 }
  ];

  it('should render movies list correctly', async () => {
    // Arrange
    const initialState = {
      movies: { list: mockMovies, loading: false, error: null }
    };

    // Act
    renderWithProviders(<MovieList />, initialState);

    // Assert
    await waitFor(() => {
      expect(screen.getByText('Test Movie 1')).toBeInTheDocument();
      expect(screen.getByText('Test Movie 2')).toBeInTheDocument();
    });
  });

  it('should handle movie click navigation', async () => {
    // Implementar teste de navega√ß√£o
  });
});
```

---

## ‚ö° **OTIMIZA√á√ïES DE PERFORMANCE**

### Backend
```php
// ‚úÖ SEMPRE use eager loading
public function getAllMovies()
{
    return Movie::with(['user'])->paginate(15);
}

// ‚úÖ SEMPRE implemente cache
public function getCachedMovies()
{
    return Cache::remember('movies.all', 3600, function () {
        return Movie::all();
    });
}

// ‚úÖ SEMPRE use √≠ndices no banco
Schema::table('movies', function (Blueprint $table) {
    $table->index(['genero', 'ano_lancamento']);
});
```

### Frontend
```jsx
// ‚úÖ SEMPRE use memo para componentes pesados
const ExpensiveMovieCard = memo(({ movie }) => {
  // componente complexo aqui
}, (prevProps, nextProps) => {
  return prevProps.movie.id === nextProps.movie.id;
});

// ‚úÖ SEMPRE use useMemo para c√°lculos pesados
const filteredMovies = useMemo(() => {
  return movies.filter(movie => 
    movie.titulo.toLowerCase().includes(searchTerm.toLowerCase())
  );
}, [movies, searchTerm]);

// ‚úÖ SEMPRE use lazy loading
const MovieDetails = lazy(() => import('./pages/MovieDetails'));
```

---

## üîÑ **PADR√ïES DE ERROR HANDLING**

### Backend
```php
// ‚úÖ SEMPRE crie exceptions espec√≠ficas
class MovieNotFoundException extends Exception
{
    public function __construct(string $message = 'Filme n√£o encontrado')
    {
        parent::__construct($message, 404);
    }
}

// ‚úÖ SEMPRE use try-catch nos services
public function updateMovie(int $id, array $data): Movie
{
    try {
        return DB::transaction(function () use ($id, $data) {
            $movie = $this->findMovieById($id);
            return $this->movieRepository->update($movie, $data);
        });
    } catch (Exception $e) {
        Log::error('Erro ao atualizar filme: ' . $e->getMessage());
        throw new MovieUpdateException('N√£o foi poss√≠vel atualizar o filme');
    }
}
```

### Frontend
```jsx
// ‚úÖ SEMPRE implemente error boundaries
class MovieErrorBoundary extends Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error('Movie Error:', error, errorInfo);
    // Enviar para servi√ßo de monitoramento
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} />;
    }
    return this.props.children;
  }
}

// ‚úÖ SEMPRE trate erros em hooks
const useMovieApi = () => {
  const [error, setError] = useState(null);
  
  const handleApiCall = async (apiCall) => {
    try {
      setError(null);
      return await apiCall();
    } catch (err) {
      const errorMessage = err.response?.data?.message || 'Erro inesperado';
      setError(errorMessage);
      throw err;
    }
  };

  return { error, handleApiCall };
};
```

---

## üìä **LOGGING E MONITORAMENTO**

```php
// ‚úÖ SEMPRE implemente logs estruturados
Log::info('Movie created', [
    'movie_id' => $movie->id,
    'user_id' => auth()->id(),
    'title' => $movie->titulo,
    'timestamp' => now()
]);

Log::error('Movie creation failed', [
    'error' => $exception->getMessage(),
    'user_id' => auth()->id(),
    'data' => $requestData,
    'trace' => $exception->getTraceAsString()
]);
```

```jsx
// ‚úÖ SEMPRE implemente tracking de eventos
const trackMovieAction = (action, movieId) => {
  if (process.env.NODE_ENV === 'production') {
    // analytics.track(action, { movieId, timestamp: Date.now() });
  }
};

const handleMovieCreate = async (movieData) => {
  try {
    const movie = await createMovie(movieData);
    trackMovieAction('movie_created', movie.id);
    return movie;
  } catch (error) {
    trackMovieAction('movie_create_failed', null);
    throw error;
  }
};
```

---

## üê≥ **DOCKER E DEPLOY**

```dockerfile
# ‚úÖ SEMPRE use multi-stage builds
# Backend Dockerfile
FROM php:8.2-fpm as backend
WORKDIR /var/www
COPY composer*.json ./
RUN composer install --no-dev --optimize-autoloader
COPY . .
RUN php artisan config:cache && php artisan route:cache

# Frontend Dockerfile  
FROM node:18-alpine as frontend
WORKDIR /app
COPY package*.json ./
RUN npm ci --only-production
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=frontend /app/dist /usr/share/nginx/html
```

```yaml
# ‚úÖ SEMPRE configure healthchecks
version: '3.8'
services:
  app:
    build: ./backend
    healthcheck:
      test: ["CMD", "php", "artisan", "health:check"]
      interval: 30s
      timeout: 10s
      retries: 3
    
  frontend:
    build: ./frontend
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
```

---

## üîß **COMANDOS √öTEIS**

```bash
# ‚úÖ Setup inicial do projeto
composer create-project laravel/laravel movie-api
cd movie-api
composer require tymon/jwt-auth
php artisan vendor:publish --provider="Tymon\JWTAuth\Providers\LaravelServiceProvider"
php artisan jwt:secret

# ‚úÖ Comandos de desenvolvimento
php artisan make:controller Api/MovieController --api
php artisan make:service MovieService
php artisan make:repository MovieRepository
php artisan make:request MovieStoreRequest
php artisan make:resource MovieResource

# ‚úÖ Frontend setup
npx create-react-app movie-frontend
cd movie-frontend
npm install @reduxjs/toolkit react-redux react-router-dom axios
```

---

## üìã **CHECKLIST DE QUALIDADE**

Antes de commitar, SEMPRE verifique:

### Backend
- [ ] Controllers apenas delegam para Services
- [ ] Services cont√™m toda l√≥gica de neg√≥cio
- [ ] Repositories abstraem acesso aos dados
- [ ] Form Requests validam entrada
- [ ] Resources formatam sa√≠da da API
- [ ] Exceptions personalizadas criadas
- [ ] Logs estruturados implementados
- [ ] Testes unit√°rios e feature criados

### Frontend
- [ ] Componentes s√£o pequenos e focados
- [ ] Hooks customizados para l√≥gica complexa
- [ ] Estado global gerenciado pelo Redux
- [ ] Error boundaries implementados
- [ ] Loading states em todas opera√ß√µes
- [ ] Memoization aplicada onde necess√°rio
- [ ] PropTypes ou TypeScript definidos
- [ ] Testes de componente criados

### Geral
- [ ] Docker funcionando corretamente
- [ ] README atualizado
- [ ] Vari√°veis de ambiente documentadas
- [ ] Performance otimizada
- [ ] Seguran√ßa implementada
- [ ] C√≥digo limpo e comentado

---

**üéØ LEMBRE-SE**: Voc√™ √© um desenvolvedor S√äNIOR. Seu c√≥digo deve ser:
- **Limpo e leg√≠vel**
- **Test√°vel e testado**
- **Perform√°tico e otimizado**
- **Seguro e confi√°vel**
- **Documentado e manuten√≠vel**

**Sempre pense**: "Este c√≥digo ser√° mantido por outros desenvolvedores por anos. Como posso facilitar a vida deles?"
